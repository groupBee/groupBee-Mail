# 이메일 서비스 요약

## 프로젝트 개요
이 프로젝트는 그룹웨어 시스템에서 사용자가 이메일을 발송하고 수신할 수 있도록 하는 그룹비만읜 **특별한** **이메일 서비스**입니다. **SMTP**와 **IMAP** 프로토콜을 사용하여 이메일을 전송하고, 보낸 이메일을 '보낸 편지함'에 저장하거나 수신함을 통해 받은 이메일을 확인할 수 있습니다. 또한 **OpenFeign**을 활용하여 인증된 사용자 정보를 연동하고, 이메일 발송에 필요한 계정 정보를 자동으로 가져옵니다.

## 사용 기술

### Backend (서버 및 데이터 관리)

- **Spring Boot**
  Spring Boot는 이 프로젝트의 백엔드 프레임워크로 선택되었습니다. REST API를 쉽게 설정하고, 사용자에게 안정적이고 신속한 서비스 제공을 위한 비즈니스 로직을 처리할 수 있습니다. 유연한 확장성과 빠른 개발 환경 구축을 통해 이메일 전송 및 수신 등의 기능을 효과적으로 구현하였습니다.

- **Jakarta Mail**
  Jakarta Mail을 사용하여 이메일 송수신을 처리했습니다. 이 라이브러리는 SMTP 및 IMAP 프로토콜을 사용하여 이메일을 발송하고, 발송된 이메일은 IMAP 서버에 저장하여 보낸 편지함에 저장되는 구조를 구축하였습니다.

- **MongoDB**
  MongoDB는 NoSQL 기반의 데이터베이스로서 이메일 메타데이터 및 발송 기록을 저장하는 데 사용되었습니다. 이는 이메일 서비스의 비정형 데이터를 효율적으로 관리할 수 있게 해주며, JSON 기반의 데이터 처리가 간편합니다.

- **OpenFeign**
  OpenFeign은 세션에서 사용자 정보를 받아오는 데 사용되었으며, 이를 통해 사용자는 추가적인 로그인이나 정보 입력 없이 이메일을 송수신할 수 있습니다. Feign Client를 통해 쉽게 외부 API와 연동하여 사용자 인증을 처리하였습니다.

- **Fail2Ban**
  Fail2Ban은 서버 보안을 위해 도입되었으며, 비정상적인 로그인 시도를 감지하여 해당 IP를 차단함으로써 무차별 대입 공격 등으로부터 시스템을 보호합니다. 이를 통해 서비스의 안정성과 보안을 더욱 강화할 수 있었습니다.

### DevOps & 클라우드

- **MinIO**
  이메일 서비스에서 첨부 파일을 관리하기 위해 MinIO를 사용하였습니다. MinIO는 S3 호환 객체 스토리지로, 이메일 첨부 파일을 안정적으로 저장하고 관리할 수 있는 기능을 제공합니다.

### Additional Libraries & Tools

- **Feign Client**
  사용자의 인증된 정보를 연동하여, 추가적인 로그인 정보 없이 사용자의 이메일 계정 및 비밀번호를 관리하였습니다. 이를 통해 이메일 송수신 작업을 자동화하고 편리성을 높였습니다.

- **Jackson**
  JSON 직렬화 및 역직렬화를 위해 사용되었습니다. 이메일 데이터와의 통신에서 복잡한 데이터 구조를 간소화하고, JSON 기반의 데이터 처리를 유연하게 관리할 수 있었습니다.

- **Lombok**
  Lombok을 사용하여 getter, setter, 생성자 등을 자동으로 생성함으로써 코드의 보일러플레이트를 줄이고 가독성을 높였습니다. 이메일 데이터 처리와 서비스 클래스에서 코드 효율성을 높였습니다.


## 주요 기능
1. **이메일 발송**
   - 사용자는 이메일을 여러 수신자에게 동시에 보낼 수 있으며, 참조(CC) 기능을 통해 이메일을 추가적으로 발송할 수 있습니다.
   - `EmailService`에서 **SMTP**를 사용하여 이메일을 발송하고, 발송 성공 여부에 따라 적절한 응답을 반환합니다.
   
2. **보낸 이메일 저장**
   - 발송된 이메일은 **IMAP**을 사용해 사용자의 '보낸 편지함'에 저장됩니다.
   - 이메일 발송 후, 발송된 메시지의 MIME 형식을 파싱하여 **IMAP**을 통해 저장합니다.

3. **이메일 수신**
   - `checkEmail` 메소드를 통해 사용자가 받은 이메일을 조회하고, 각 이메일의 내용(제목, 발신자, 수신 시간)을 확인할 수 있습니다.
   - 수신된 이메일은 **IMAP** 프로토콜을 사용하여 'INBOX' 폴더에서 확인됩니다.
   
4. **사용자 인증 정보 연동**
   - **Feign Client**를 통해 세션에 저장된 사용자의 이메일 계정 정보(이메일, 비밀번호)를 가져와 **SMTP**와 **IMAP** 통신에 활용합니다.
   - `EmployeeFeignClient`는 사용자 정보 API와 통신하여 필요한 정보를 실시간으로 받아옵니다.

5. **Fail2Ban 보안 강화**
   - **Fail2Ban**을 통해 비정상적인 접근 시도를 감지하고, 해당 IP를 차단하여 이메일 서비스의 보안을 강화하였습니다.
   - 이를 통해 스팸 공격이나 무차별 대입 공격(Brute-force Attack)으로부터 시스템을 보호할 수 있습니다.

---

## 주요 클래스 및 역할

### 1. **EmailRequest (DTO)**
   - 이메일을 발송할 때 필요한 필수 정보를 담고 있습니다.
   - **필드**: 수신자 리스트(to), 참조 리스트(cc), 이메일 제목(subject), 이메일 본문(body)

### 2. **EmailController (컨트롤러)**
#### Rest-api
   - **/send**: 사용자가 요청한 이메일을 발송하고, 발송 성공 여부에 대한 응답을 반환합니다.
   - **/check**: 사용자가 수신한 이메일을 조회합니다.
   - **/sent**: 사용자가 보낸 이메일을 조회합니다.
   - 발송 및 수신 오류 발생 시 **ResponseStatusException**을 통해 적절한 에러 메시지를 반환합니다.

### 3. **EmailService (서비스)**
   - **sendEmail**: 이메일을 발송하고, 발송된 이메일을 **IMAP**을 통해 보낸 편지함에 저장하는 역할을 합니다.
   - **checkEmail**: 사용자의 'INBOX' 폴더에서 이메일을 확인합니다.
   - **sentEmail**: 사용자의 '보낸 편지함'에서 이메일을 확인합니다.
   - **saveSentEmailToIMAP**: 발송된 이메일을 IMAP 서버에 저장합니다.

### 4. **SessionInterceptor (세션 인터셉터)**
   - **apply**: 현재 세션에서 사용자 쿠키 정보를 가져와, 이메일 발송 시 **Feign Client**를 통해 인증된 상태로 요청을 전송할 수 있게 해줍니다.

### 5. **EmployeeFeignClient (OpenFeign)**
   - 세션 정보를 통해 사용자 인증 정보를 가져오고, 이를 이메일 발송 및 수신에 활용합니다.

---

